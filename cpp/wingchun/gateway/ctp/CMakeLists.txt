PROJECT(ctp_gateway)

SET(MD_SOURCE_FILES md/md_gateway.cpp md/md_gateway.h)
SET(TD_SOURCE_FILES td/td_gateway.cpp td/td_gateway.h td/order_mapper.h)

if(UNIX AND NOT APPLE)
    set(CTP_API_VERSION v6.3.6_20160606)
    INCLUDE_DIRECTORIES(api/${CTP_API_VERSION}/include)
    LINK_DIRECTORIES(api/${CTP_API_VERSION}/lib)
endif()

if(WIN32)
    set(CTP_API_VERSION 20150803_tradeapi_win64)
    INCLUDE_DIRECTORIES(api/${CTP_API_VERSION})
    LINK_DIRECTORIES(api/${CTP_API_VERSION})
endif()

if(UNIX AND NOT APPLE)
    ADD_LIBRARY(ctp_md SHARED ${MD_SOURCE_FILES})
    ADD_LIBRARY(ctp_td SHARED ${TD_SOURCE_FILES})
    TARGET_LINK_LIBRARIES(ctp_md ctpthostmduserapi gateway_impl fmt)
    TARGET_LINK_LIBRARIES(ctp_td ctpthosttraderapi gateway_impl fmt)
    add_executable(ctp_md_daemon md/md_gateway_daemon.cpp)
    target_link_libraries(ctp_md_daemon ctp_md)
    add_executable(ctp_td_daemon td/td_gateway_daemon.cpp)
    target_link_libraries(ctp_td_daemon ctp_td)
    FILE(COPY api/${CTP_API_VERSION}/lib/libctpthostmduserapi.so DESTINATION ${CMAKE_BINARY_DIR}/${CMAKE_BUILD_TYPE})
    FILE(COPY api/${CTP_API_VERSION}/lib/libctpthosttraderapi.so DESTINATION ${CMAKE_BINARY_DIR}/${CMAKE_BUILD_TYPE})
    add_subdirectory(pybind)
endif()

if(WIN32)
    ADD_LIBRARY(ctp_md SHARED ${MD_SOURCE_FILES})
    ADD_LIBRARY(ctp_td SHARED ${TD_SOURCE_FILES})
    TARGET_LINK_LIBRARIES(ctp_md thostmduserapi gateway_impl fmt)
    TARGET_LINK_LIBRARIES(ctp_td thosttraderapi gateway_impl fmt)
    FILE(COPY api/${CTP_API_VERSION}/thosttraderapi.dll DESTINATION ${CMAKE_BINARY_DIR}/${CMAKE_BUILD_TYPE})
    FILE(COPY api/${CTP_API_VERSION}/thostmduserapi.dll DESTINATION ${CMAKE_BINARY_DIR}/${CMAKE_BUILD_TYPE})
    add_executable(ctp_md_gateway_daemon md/md_gateway_daemon.cpp)
    target_link_libraries(ctp_md_gateway_daemon ctp_md)
    add_executable(ctp_td_gateway_daemon td/td_gateway_daemon.cpp)
    target_link_libraries(ctp_td_gateway_daemon ctp_td)
    add_subdirectory(pybind)
endif()